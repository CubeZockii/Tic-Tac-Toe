<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic Tac Toe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: radial-gradient(circle, #1e1e2e, #121212);
            color: white;
            font-family: 'Arial', sans-serif;
            text-align: center;
        }
        .board {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-template-rows: repeat(3, 100px);
            gap: 10px;
            margin-top: 20px;
        }
        .cell {
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            cursor: pointer;
            border-radius: 15px;
            transition: 0.3s;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
        }
        .cell:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .winner {
            background: rgba(34, 197, 94, 0.6) !important;
            animation: flash 1s infinite;
        }
        @keyframes flash {
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>

    <h1 class="text-5xl font-bold mt-6">Tic Tac Toe</h1>

    <div class="flex gap-4 mt-6">
        <button onclick="startGame(false)" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded text-lg">2 Spieler</button>
        <button onclick="toggleDifficulty()" class="px-6 py-3 bg-green-600 hover:bg-green-700 rounded text-lg">KI-Stufe: <span id="difficulty">Leicht</span></button>
        <button onclick="startGame(true)" class="px-6 py-3 bg-green-600 hover:bg-green-700 rounded text-lg">Gegen KI</button>
    </div>

    <div id="board" class="board">
        <div class="cell" onclick="makeMove(0)"></div>
        <div class="cell" onclick="makeMove(1)"></div>
        <div class="cell" onclick="makeMove(2)"></div>
        <div class="cell" onclick="makeMove(3)"></div>
        <div class="cell" onclick="makeMove(4)"></div>
        <div class="cell" onclick="makeMove(5)"></div>
        <div class="cell" onclick="makeMove(6)"></div>
        <div class="cell" onclick="makeMove(7)"></div>
        <div class="cell" onclick="makeMove(8)"></div>
    </div>

    <p id="status" class="text-2xl mt-4"></p>

    <script>
        let board = ["", "", "", "", "", "", "", "", ""];
        let currentPlayer = "X";
        let aiMode = false;
        let gameOver = false;
        let difficulty = 0; // 0 = Leicht, 1 = Mittel, 2 = Schwer
        const difficulties = ["Leicht", "Mittel", "Schwer"];

        function toggleDifficulty() {
            difficulty = (difficulty + 1) % 3;
            document.getElementById("difficulty").textContent = difficulties[difficulty];
        }

        function startGame(ai) {
            board = ["", "", "", "", "", "", "", "", ""];
            currentPlayer = "X";
            aiMode = ai;
            gameOver = false;
            document.getElementById("status").textContent = "";
            document.querySelectorAll(".cell").forEach(cell => {
                cell.textContent = "";
                cell.classList.remove("winner");
            });
        }

        function makeMove(index) {
            if (board[index] || gameOver) return;

            board[index] = currentPlayer;
            document.querySelectorAll(".cell")[index].textContent = currentPlayer;

            if (checkWinner()) {
                document.getElementById("status").textContent = `${currentPlayer} gewinnt!`;
                highlightWinner();
                gameOver = true;
                setTimeout(() => startGame(aiMode), 2000);
                return;
            }

            if (board.every(cell => cell !== "")) {
                document.getElementById("status").textContent = "Unentschieden!";
                gameOver = true;
                setTimeout(() => startGame(aiMode), 2000);
                return;
            }

            currentPlayer = currentPlayer === "X" ? "O" : "X";

            if (aiMode && currentPlayer === "O" && !gameOver) {
                setTimeout(aiMove, 500);
            }
        }

        function aiMove() {
            let bestMove;
            if (difficulty === 0) {
                bestMove = easyMove();
            } else if (difficulty === 1) {
                bestMove = mediumMove();
            } else {
                bestMove = minimax(board, "O").index;
            }
            makeMove(bestMove);
        }

        function easyMove() {
            let emptyCells = board.map((val, idx) => val === "" ? idx : null).filter(v => v !== null);
            return emptyCells[Math.floor(Math.random() * emptyCells.length)];
        }

        function mediumMove() {
            return Math.random() < 0.5 ? minimax(board, "O").index : easyMove();
        }

        function minimax(newBoard, player) {
            let emptyCells = newBoard.map((val, idx) => val === "" ? idx : null).filter(v => v !== null);
            if (checkWinnerState(newBoard, "X")) return { score: -10 };
            if (checkWinnerState(newBoard, "O")) return { score: 10 };
            if (emptyCells.length === 0) return { score: 0 };

            let moves = [];
            for (let i of emptyCells) {
                let move = {};
                move.index = i;
                newBoard[i] = player;
                move.score = player === "O" ? minimax(newBoard, "X").score : minimax(newBoard, "O").score;
                newBoard[i] = "";
                moves.push(move);
            }

            return moves.reduce((best, move) => 
                (player === "O" ? move.score > best.score : move.score < best.score) ? move : best
            , moves[0]);
        }

        function checkWinner() {
            const winPatterns = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
            return winPatterns.some(pattern => board[pattern[0]] && board[pattern[0]] === board[pattern[1]] && board[pattern[1]] === board[pattern[2]]);
        }

        function highlightWinner() {
            document.querySelectorAll(".cell").forEach(cell => cell.classList.add("winner"));
        }
    </script>

</body>
</html>
