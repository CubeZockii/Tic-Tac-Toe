<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic Tac Toe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1e3a8a, #9333ea);
            color: white;
            font-family: 'Arial', sans-serif;
        }
        .board {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-template-rows: repeat(3, 100px);
            gap: 10px;
        }
        .cell {
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            cursor: pointer;
            border-radius: 10px;
            transition: 0.3s;
        }
        .cell:hover {
            background: rgba(255, 255, 255, 0.4);
        }
        .winner {
            animation: flash 1s infinite;
        }
        @keyframes flash {
            0%, 100% { background: rgba(34, 197, 94, 0.6); }
            50% { background: rgba(34, 197, 94, 1); }
        }
        .disabled {
            opacity: 0.5;
            pointer-events: none;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen">

    <h1 class="text-5xl font-bold mb-4">Tic Tac Toe</h1>

    <div class="flex gap-4 mb-6">
        <button id="mode-btn" onclick="startGame(false)" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded text-lg">2 Player</button>
        <button id="difficulty-btn" onclick="toggleDifficulty()" class="px-6 py-3 bg-yellow-600 hover:bg-yellow-700 rounded text-lg">AI Level: <span id="difficulty">Easy</span></button>
        <button id="ai-btn" onclick="startGame(true)" class="px-6 py-3 bg-green-600 hover:bg-green-700 rounded text-lg">Play vs AI</button>
    </div>

    <div id="board" class="board">
        <div class="cell" onclick="makeMove(0)"></div>
        <div class="cell" onclick="makeMove(1)"></div>
        <div class="cell" onclick="makeMove(2)"></div>
        <div class="cell" onclick="makeMove(3)"></div>
        <div class="cell" onclick="makeMove(4)"></div>
        <div class="cell" onclick="makeMove(5)"></div>
        <div class="cell" onclick="makeMove(6)"></div>
        <div class="cell" onclick="makeMove(7)"></div>
        <div class="cell" onclick="makeMove(8)"></div>
    </div>

    <p id="status" class="text-2xl mt-4"></p>

<script>
    let board = ["", "", "", "", "", "", "", "", ""];
    let currentPlayer = "X";
    let aiMode = false;
    let gameOver = false;
    let difficulty = 0;
    let hasStarted = false;
    const difficulties = ["Easy", "Medium", "Hard", "Unbeatable"];

    function toggleDifficulty() {
        if (hasStarted) return;
        difficulty = (difficulty + 1) % 4;
        document.getElementById("difficulty").textContent = difficulties[difficulty];
    }

    function startGame(ai) {
    board = ["", "", "", "", "", "", "", "", ""];
    currentPlayer = "X";
    aiMode = ai;
    gameOver = false;
    hasStarted = false; // Richtige ZurÃ¼cksetzung

    document.getElementById("status").textContent = "";
    document.querySelectorAll(".cell").forEach(cell => {
        cell.textContent = "";
        cell.classList.remove("winner");
    });

    enableButtons(); // Buttons wieder aktivieren
}

    function makeMove(index) {
        if (board[index] || gameOver) return;

        if (!hasStarted) {
            hasStarted = true;
            disableButtons();
        }

        board[index] = currentPlayer;
        document.querySelectorAll(".cell")[index].textContent = currentPlayer;

        let winningPattern = checkWinner();
        if (winningPattern) {
            document.getElementById("status").textContent = `${currentPlayer} Won!`;
            highlightWinner(winningPattern);
            gameOver = true;
            setTimeout(() => startGame(aiMode), 2000);
            return;
        }

        if (board.every(cell => cell !== "")) {
            document.getElementById("status").textContent = "Draw!";
            gameOver = true;
            setTimeout(() => startGame(aiMode), 2000);
            return;
        }

        currentPlayer = currentPlayer === "X" ? "O" : "X";

        if (aiMode && currentPlayer === "O" && !gameOver) {
            setTimeout(aiMove, 500);
        }
    }

    function aiMove() {
        let bestMove;
        switch (difficulty) {
            case 0: bestMove = easyMove(); break;
            case 1: bestMove = mediumMove(); break;
            case 2: bestMove = hardMove(); break;
            case 3: // Unschlagbar (Minimax)
                let minimaxResult = minimax(board, "O");
                bestMove = minimaxResult.index !== undefined ? minimaxResult.index : easyMove();
                break;
        }
        makeMove(bestMove);
    }

    function easyMove() {
        let emptyCells = board.map((val, idx) => val === "" ? idx : null).filter(v => v !== null);
        return emptyCells[Math.floor(Math.random() * emptyCells.length)];
    }

    function mediumMove() {
        return Math.random() < 0.5 ? minimax(board, "O").index : easyMove();
    }

    function hardMove() {
        return Math.random() < 0.8 ? minimax(board, "O").index : easyMove();
    }

    function minimax(newBoard, player) {
        let emptyCells = newBoard.map((val, idx) => val === "" ? idx : null).filter(v => v !== null);

        if (checkWinnerState(newBoard, "X")) return { score: -10 };
        if (checkWinnerState(newBoard, "O")) return { score: 10 };
        if (emptyCells.length === 0) return { score: 0 };

        let moves = emptyCells.map(i => {
            newBoard[i] = player;
            let score = player === "O" ? minimax(newBoard, "X").score : minimax(newBoard, "O").score;
            newBoard[i] = "";
            return { index: i, score };
        });

        return moves.reduce((bestMove, move) => (player === "O" ? move.score > bestMove.score : move.score < bestMove.score) ? move : bestMove);
    }

    function disableButtons() {
        document.getElementById("mode-btn").classList.add("disabled");
        document.getElementById("difficulty-btn").classList.add("disabled");
        document.getElementById("ai-btn").classList.add("disabled");
    }

    function enableButtons() {
        document.getElementById("mode-btn").classList.remove("disabled");
        document.getElementById("difficulty-btn").classList.remove("disabled");
        document.getElementById("ai-btn").classList.remove("disabled");
    }

    function checkWinner() {
        const winPatterns = [
            [0,1,2], [3,4,5], [6,7,8], // Reihen
            [0,3,6], [1,4,7], [2,5,8], // Spalten
            [0,4,8], [2,4,6] // Diagonalen
        ];
        for (let pattern of winPatterns) {
            if (board[pattern[0]] && board[pattern[0]] === board[pattern[1]] && board[pattern[1]] === board[pattern[2]]) {
                return pattern;
            }
        }
        return null;
    }

    function highlightWinner(pattern) {
        pattern.forEach(i => document.querySelectorAll(".cell")[i].classList.add("winner"));
    }

    function checkWinnerState(testBoard, player) {
        const winPatterns = [
            [0,1,2], [3,4,5], [6,7,8], // Reihen
            [0,3,6], [1,4,7], [2,5,8], // Spalten
            [0,4,8], [2,4,6] // Diagonalen
        ];
        return winPatterns.some(pattern => pattern.every(i => testBoard[i] === player));
    }
</script>

</body>
</html>