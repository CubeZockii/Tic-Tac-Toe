<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic Tac Toe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1e3a8a, #9333ea);
            color: white;
            font-family: 'Arial', sans-serif;
        }
        .board {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-template-rows: repeat(3, 100px);
            gap: 10px;
        }
        .cell {
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            cursor: pointer;
            border-radius: 10px;
            transition: 0.3s;
        }
        .cell:hover {
            background: rgba(255, 255, 255, 0.4);
        }
        .winner {
            background: rgba(34, 197, 94, 0.6) !important;
            animation: flash 1s infinite;
        }
        @keyframes flash {
            50% { opacity: 0.5; }
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen">

    <h1 class="text-5xl font-bold mb-4">Tic Tac Toe</h1>
    
    <div class="flex gap-4 mb-6">
        <button onclick="startGame(false)" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded text-lg">2 Spieler</button>
        <button onclick="showMultiplayerMenu()" class="px-6 py-3 bg-green-600 hover:bg-green-700 rounded text-lg">Multiplayer</button>
    </div>

    <div id="multiplayer-menu" class="hidden flex flex-col items-center gap-2">
        <button onclick="createRoom()" class="px-6 py-3 bg-purple-600 hover:bg-purple-700 rounded text-lg">Raum erstellen</button>
        <button onclick="joinRoom()" class="px-6 py-3 bg-yellow-600 hover:bg-yellow-700 rounded text-lg">Raum beitreten</button>
        <p id="room-info" class="text-lg mt-2"></p>
    </div>

    <div id="board" class="board">
        <div class="cell" onclick="makeMove(0)"></div>
        <div class="cell" onclick="makeMove(1)"></div>
        <div class="cell" onclick="makeMove(2)"></div>
        <div class="cell" onclick="makeMove(3)"></div>
        <div class="cell" onclick="makeMove(4)"></div>
        <div class="cell" onclick="makeMove(5)"></div>
        <div class="cell" onclick="makeMove(6)"></div>
        <div class="cell" onclick="makeMove(7)"></div>
        <div class="cell" onclick="makeMove(8)"></div>
    </div>

    <p id="status" class="text-2xl mt-4"></p>

    <script>
        let board = ["", "", "", "", "", "", "", "", ""];
        let currentPlayer = "X";
        let gameOver = false;
        let onlineMode = false;
        let roomCode = "";

        const socket = io();

        function startGame(online) {
            board = ["", "", "", "", "", "", "", "", ""];
            currentPlayer = "X";
            gameOver = false;
            onlineMode = online;
            document.getElementById("status").textContent = "";
            document.querySelectorAll(".cell").forEach(cell => {
                cell.textContent = "";
                cell.classList.remove("winner");
            });
        }

        function makeMove(index) {
            if (board[index] || gameOver) return;

            if (onlineMode) {
                socket.emit("make_move", { room: roomCode, index: index });
            } else {
                localMove(index);
            }
        }

        function localMove(index) {
            board[index] = currentPlayer;
            document.querySelectorAll(".cell")[index].textContent = currentPlayer;

            let winningPattern = checkWinner();
            if (winningPattern) {
                document.getElementById("status").textContent = `${currentPlayer} gewinnt!`;
                highlightWinner(winningPattern);
                gameOver = true;
                setTimeout(() => startGame(false), 2000);
                return;
            }

            if (board.every(cell => cell !== "")) {
                document.getElementById("status").textContent = "Unentschieden!";
                gameOver = true;
                setTimeout(() => startGame(false), 2000);
                return;
            }

            currentPlayer = currentPlayer === "X" ? "O" : "X";
        }

        function checkWinner() {
            const winPatterns = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
            return winPatterns.find(pattern => pattern.every(i => board[i] === currentPlayer));
        }

        function highlightWinner(pattern) {
            pattern.forEach(i => document.querySelectorAll(".cell")[i].classList.add("winner"));
        }

        function showMultiplayerMenu() {
            document.getElementById("multiplayer-menu").classList.toggle("hidden");
        }

        function createRoom() {
            socket.emit("create_room");
        }

        function joinRoom() {
            roomCode = prompt("Gib den Raumcode ein:");
            socket.emit("join_room", { room: roomCode });
        }

        socket.on("room_created", (data) => {
            roomCode = data.room;
            document.getElementById("room-info").textContent = "Raumcode: " + roomCode;
            onlineMode = true;
        });

        socket.on("room_joined", () => {
            document.getElementById("room-info").textContent = "Beigetreten: " + roomCode;
            onlineMode = true;
        });

        socket.on("update_board", (data) => {
            board = data.board;
            document.querySelectorAll(".cell").forEach((cell, i) => {
                cell.textContent = board[i];
            });
        });
    </script>

</body>
</html>
